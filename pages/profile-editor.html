<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Settings | Yeeps-Share</title>
    <link rel="stylesheet" href="../style.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <nav class="top-nav"><a href="../index.html">üè† Home</a></nav>

    <div class="admin-panel" style="margin-top:20px;">
        <h2>Edit Profile</h2>
        <p>Logged in as: <b id="me"></b></p>
        
        <label>PFP Link:</label>
        <input type="text" id="newPfp" placeholder="Paste image link here">
        
        <label>Your Bio:</label>
        <textarea id="newBio" placeholder="Tell us about yourself..."></textarea>
        
        <button id="saveBtn" style="width:100%; background:var(--yeeps-orange); color:white;">SAVE CHANGES</button>
    </div>

    <script>
        const firebaseConfig = { /* YOUR KEYS */ };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const user = localStorage.getItem('current_yeep_user');
        document.getElementById('me').innerText = user;

        // Auto-load current data
        db.collection("users").doc(user).get().then(doc => {
            if(doc.exists) {
                document.getElementById('newPfp').value = doc.data().pfp || "";
                document.getElementById('newBio').value = doc.data().bio || "";
            }
        });

        // Fixed Save Button Logic
        document.getElementById('saveBtn').onclick = function() {
            const p = document.getElementById('newPfp').value.trim();
            const b = document.getElementById('newBio').value.trim();

            db.collection("users").doc(user).set({
                pfp: p,
                bio: b
            }, { merge: true }).then(() => {
                alert("Saved!");
                window.location.href = "../index.html";
            }).catch(err => alert("Error: " + err));
        };
    </script>
</body>
</html>
