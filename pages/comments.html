<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Comments | Yeeps-Share</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <nav class="top-nav">
        <a href="../index.html">üè† Back to Feed</a>
    </nav>

    <div id="originalPost" style="margin-top:20px;"></div>

    <div class="input-box">
        <h3>Comments</h3>
        <div id="commentList" style="max-height: 400px; overflow-y: auto; margin-bottom: 20px;"></div>
        <hr>
        <textarea id="commentText" placeholder="Write a reply..." style="width:95%; height:60px;"></textarea>
        <button onclick="postComment()" style="width:100%; background:var(--yeeps-orange); color:white; margin-top:10px;">Post Reply</button>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const postId = params.get('postId');
        const currentUser = localStorage.getItem('current_yeep_user');

        function loadComments() {
            // Load Original Post
            const posts = JSON.parse(localStorage.getItem('yeepsPosts')) || [];
            const post = posts.find(p => p.id == postId);
            if(post) {
                document.getElementById('originalPost').innerHTML = `
                    <div class="post">
                        <strong>${post.username}</strong>
                        <p>${post.content}</p>
                    </div>`;
            }

            // Load Comments
            const allComments = JSON.parse(localStorage.getItem('yeeps_comments')) || {};
            const comments = allComments[postId] || [];
            const list = document.getElementById('commentList');
            list.innerHTML = comments.length === 0 ? "<p>No comments yet. Be the first!</p>" : "";

            comments.forEach(c => {
                list.innerHTML += `
                    <div style="border-bottom: 1px solid #eee; padding: 10px 0;">
                        <strong style="color:var(--yeeps-orange);">${c.user}:</strong>
                        <span>${c.text}</span>
                    </div>`;
            });
        }

        function postComment() {
            const text = document.getElementById('commentText').value.trim();
            if(!text) return;

            let allComments = JSON.parse(localStorage.getItem('yeeps_comments')) || {};
            if(!allComments[postId]) allComments[postId] = [];

            allComments[postId].push({
                user: currentUser,
                text: text,
                time: Date.now()
            });

            localStorage.setItem('yeeps_comments', JSON.stringify(allComments));
            document.getElementById('commentText').value = "";
            loadComments();
        }

        loadComments();
    </script>
</body>
</html>
