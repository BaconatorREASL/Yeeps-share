<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Comments | Yeeps-Share</title>
    <link rel="stylesheet" href="../style.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <nav class="top-nav">
        <a href="../index.html">üè† Back to Feed</a>
    </nav>

    <div id="originalPost"></div>

    <div class="input-box">
        <textarea id="commentText" placeholder="Write a comment..."></textarea>
        <button onclick="postComment()" style="width:100%; background:var(--yeeps-orange); color:white;">SEND COMMENT</button>
    </div>

    <div id="commentSection"></div>

    <script>
        const firebaseConfig = { /* ... your config ... */ };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const currentUser = localStorage.getItem('current_yeep_user');
        const urlParams = new URLSearchParams(window.location.search);
        const postId = urlParams.get('postId');

        // 1. Load the actual post at the top
        db.collection("posts").doc(postId).onSnapshot((doc) => {
            const p = doc.data();
            document.getElementById('originalPost').innerHTML = `
                <div class="post">
                    <strong>${p.username}</strong>
                    <p>${p.content}</p>
                </div>
            `;
        });

        // 2. Load comments in real-time
        db.collection("posts").doc(postId).collection("comments").orderBy("timestamp", "asc").onSnapshot((snap) => {
            const section = document.getElementById('commentSection');
            section.innerHTML = "";
            snap.forEach(doc => {
                const c = doc.data();
                section.innerHTML += `
                    <div class="post" style="width:400px; margin-left:40px; font-size:0.9em;">
                        <strong>${c.username}:</strong> ${c.text}
                    </div>
                `;
            });
        });

        async function postComment() {
            const text = document.getElementById('commentText').value.trim();
            if(!text) return;
            await db.collection("posts").doc(postId).collection("comments").add({
                username: currentUser,
                text: text,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            document.getElementById('commentText').value = "";
        }
    </script>
</body>
</html>
