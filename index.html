<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Yeeps-Share | Home</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <nav class="top-nav">
        <a href="index.html">üè† Home</a>
        <a href="pages/profile-editor.html">‚öôÔ∏è My Profile</a>
        <a href="#" onclick="logout()" style="color:#ff4d4d;">Logout</a>
    </nav>

    <div class="music-ctrl">
        <button onclick="toggleMusic()" id="mBtn">üîá</button>
        <audio id="bgMusic" loop><source src="music/SuburbTheme.ogg" type="audio/ogg"></audio>
    </div>

    <h1>üß± Yeeps-Share</h1>

    <div id="modPanel" style="display:none;" class="admin-panel">
        <strong id="staffTitle">üõ°Ô∏è Staff Tools</strong><br><br>
        <input type="text" id="modTarget" placeholder="Username to Suspend" style="width:150px;">
        <select id="modAction">
            <option value="warn">Warn User</option>
            <option value="timeout">10 Minute Timeout</option>
            <option value="ban_perm">Permanent Ban</option>
            <option value="unban">Lift Punishment</option>
        </select>
        <button onclick="applyModeration()" style="cursor:pointer; padding:5px;">Execute</button>
    </div>

    <div class="input-box">
        <input type="text" id="postContent" placeholder="What's happening?">
        <input type="text" id="postImg" placeholder="Image URL (Optional)">
        <button onclick="submitPost()" style="width:100%; padding:10px; background:var(--yeeps-orange); color:white; border:none; border-radius:10px; font-weight:bold; cursor:pointer;">Post</button>
    </div>

    <div id="featured-zone"></div>
    <div id="feed"></div>

    <script>
        const ADMIN_NAME = "DatWeirdFNFfan";
        const currentUser = localStorage.getItem('current_yeep_user');

        // 1. LOGIN & BAN CHECK
        if (!currentUser) window.location.href = "login.html";
        const statusDB = JSON.parse(localStorage.getItem('yeeps_status_db')) || {};
        const myStatus = statusDB[currentUser];
        if (myStatus && myStatus.type !== "unban" && myStatus.type !== "warn") window.location.href = "ban.html";
        if (myStatus && myStatus.type === "warn") alert("‚ö†Ô∏è WARNING: Your account has been flagged for a rules violation.");

        function toggleMusic() {
            const m = document.getElementById('bgMusic');
            m.paused ? (m.play(), document.getElementById('mBtn').innerText="üîä") : (m.pause(), document.getElementById('mBtn').innerText="üîá");
        }

        // 2. MODERATION LOGIC (EXCLUDES GAME MODS)
        const rolesDB = JSON.parse(localStorage.getItem('yeeps_roles_db')) || {};
        const myRole = currentUser === ADMIN_NAME ? "owner" : (rolesDB[currentUser] || "");
        
        // Permission Hierarchy (Game Mod is excluded from staff powers)
        const staffPower = { "webmod": 1, "dev": 2, "owner": 3 };
        if (staffPower[myRole]) document.getElementById('modPanel').style.display = 'block';

        function applyModeration() {
            const target = document.getElementById('modTarget').value.trim();
            const action = document.getElementById('modAction').value;
            const targetRole = target === ADMIN_NAME ? "owner" : (rolesDB[target] || "");

            const myLvl = staffPower[myRole] || 0;
            const targetLvl = staffPower[targetRole] || 0;

            if (targetLvl >= myLvl || target === currentUser) {
                alert("You cannot moderate someone with equal or higher rank!");
                return;
            }

            let expiry = 0;
            if (action === "timeout") expiry = Date.now() + (10 * 60 * 1000);
            if (action === "ban_perm") expiry = "PERMANENT";

            statusDB[target] = { type: action, expires: expiry };
            localStorage.setItem('yeeps_status_db', JSON.stringify(statusDB));
            alert(`Action ${action} executed on ${target}`);
            location.reload();
        }

        function reportPost(id, user) {
            let reports = JSON.parse(localStorage.getItem('yeeps_reports')) || [];
            reports.push({ postId: id, reported: user, reporter: currentUser });
            localStorage.setItem('yeeps_reports', JSON.stringify(reports));
            alert("Post reported to Web Mods.");
        }

        // 3. FEED LOGIC
        function loadFeed() {
            const posts = JSON.parse(localStorage.getItem('yeepsPosts')) || [];
            const usersDB = JSON.parse(localStorage.getItem('yeeps_users_db')) || {};
            
            posts.slice().reverse().forEach(p => {
                const pfp = usersDB[p.username]?.pfp || "https://ui-avatars.com/api/?name=" + p.username;
                let rKey = p.username === ADMIN_NAME ? "owner" : (rolesDB[p.username] || "");
                
                const div = document.createElement('div');
                div.className = `post ${p.isPinned ? 'pinned' : ''}`;
                div.innerHTML = `
                    <div class="post-header">
                        <img src="${pfp}" class="pfp-img" onclick="location.href='pages/user-profile.html?u=${p.username}'">
                        <div>
                            <strong>${p.username}</strong>
                            ${rKey ? `<div class="badge role-${rKey}">${rKey}</div>` : ''}
                        </div>
                    </div>
                    <p>${p.content}</p>
                    <div style="display:flex; gap:10px;">
                        <a href="pages/comments.html?postId=${p.id}" style="font-size:0.8rem;">üí¨ Comments</a>
                        <span onclick="reportPost(${p.id}, '${p.username}')" style="cursor:pointer; color:gray; font-size:0.8rem;">üö© Report</span>
                        ${(myLvl >= 1 || p.username === currentUser) ? `<span onclick="deletePost(${p.id})" style="color:red; cursor:pointer; font-size:0.8rem;">Delete</span>` : ''}
                    </div>
                `;
                p.isPinned ? document.getElementById('featured-zone').appendChild(div) : document.getElementById('feed').appendChild(div);
            });
        }

        function submitPost() {
            const content = document.getElementById('postContent').value;
            if(!content) return;
            let p = JSON.parse(localStorage.getItem('yeepsPosts')) || [];
            p.push({ id: Date.now(), username: currentUser, content: content });
            localStorage.setItem('yeepsPosts', JSON.stringify(p));
            location.reload();
        }

        function logout() { localStorage.removeItem('current_yeep_user'); location.reload(); }
        loadFeed();
    </script>
</body>
</html>>
