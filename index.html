<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Yeeps-Share | Home</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="top-nav">
        <img src="Images/Logo/Logo.png" class="nav-logo" onclick="location.href='index.html'">
        <a href="index.html">üè† Home</a>
        <a href="pages/profile-editor.html">‚öôÔ∏è Profile</a>
        <a href="#" onclick="logout()" style="color:red;">Logout</a>
    </nav>

    <div id="staffPanel" style="display:none;" class="admin-panel">
        <strong style="color:var(--yeeps-orange);">üõ†Ô∏è Staff Dashboard</strong><br><br>
        <div style="display:flex; gap:10px;">
            <div style="flex:1; border-right:1px solid #ddd; padding-right:10px;">
                <small>Manage Roles</small>
                <input type="text" id="targetUser" placeholder="Username">
                <select id="roleSelect">
                    <option value="creator">Content Creator</option>
                    <option value="rat">Lab Rat</option>
                    <option value="star">Star Creator</option>
                    <option value="starprog">Star Program</option>
                    <option value="gamemod">Game Mod</option>
                    <option value="discordmod">Discord Mod</option>
                    <option value="webmod">Web Mod</option>
                    <option value="dev">Game Dev</option>
                </select>
                <button onclick="manageRole('add')">Give</button>
                <button onclick="manageRole('remove')" style="background:#555; color:white;">Remove</button>
                <button onclick="manageRole('clear')" style="background:red; color:white; margin-top:5px; width:100%;">Clear All</button>
            </div>
            <div style="flex:1; padding-left:10px;">
                <small>Banning System</small>
                <input type="text" id="modTarget" placeholder="Username">
                <select id="modDuration">
                    <option value="60000">1 Minute (Test)</option>
                    <option value="600000">10 Minutes</option>
                    <option value="2592000000">1 Month</option>
                    <option value="31536000000">1 Year</option>
                    <option value="PERM">Permanent</option>
                </select>
                <button onclick="applyBan()" style="background:red; color:white; width:100%;">Execute Ban</button>
            </div>
        </div>
    </div>

    <div class="input-box">
        <input type="text" id="postContent" placeholder="Post something...">
        <button onclick="submitPost()" style="width:100%; background:var(--yeeps-orange); color:white;">Post</button>
    </div>

    <div id="feed"></div>

    <script>
        const ADMIN_NAME = "DatWeirdFNFfan";
        const currentUser = localStorage.getItem('current_yeep_user');
        if (!currentUser) window.location.href = "login.html";

        // Ban Check
        const statusDB = JSON.parse(localStorage.getItem('yeeps_status_db')) || {};
        if (statusDB[currentUser] && statusDB[currentUser].type !== "warn") window.location.href = "ban.html";

        const rolesDB = JSON.parse(localStorage.getItem('yeeps_roles_db')) || {};
        const myRole = (currentUser === ADMIN_NAME) ? "owner" : (rolesDB[currentUser] || "");
        const staffPower = { "webmod": 1, "dev": 2, "owner": 3 };
        if (staffPower[myRole]) document.getElementById('staffPanel').style.display = 'block';

        function manageRole(type) {
            if (myRole !== "owner") return alert("Owner Only!");
            const target = document.getElementById('targetUser').value.trim();
            if(!target) return;
            if(type === 'add') rolesDB[target] = document.getElementById('roleSelect').value;
            else if(type === 'remove') delete rolesDB[target];
            else if(type === 'clear') delete rolesDB[target];
            localStorage.setItem('yeeps_roles_db', JSON.stringify(rolesDB));
            location.reload();
        }

        function applyBan() {
            const target = document.getElementById('modTarget').value.trim();
            const dur = document.getElementById('modDuration').value;
            const targetRole = (target === ADMIN_NAME) ? "owner" : (rolesDB[target] || "");
            if ((staffPower[targetRole] || 0) >= staffPower[myRole]) return alert("Cannot ban higher ranks!");

            let expiry = dur === "PERM" ? "PERMANENT" : Date.now() + parseInt(dur);
            statusDB[target] = { type: dur === "PERM" ? "ban_perm" : "timeout", expires: expiry, bannedAt: Date.now() };
            
            if(dur === "PERM") {
                let posts = JSON.parse(localStorage.getItem('yeepsPosts')) || [];
                localStorage.setItem('yeepsPosts', JSON.stringify(posts.filter(p => p.username !== target)));
            }
            localStorage.setItem('yeeps_status_db', JSON.stringify(statusDB));
            location.reload();
        }

        function submitPost() {
            const content = document.getElementById('postContent').value.trim();
            if(!content) return;
            let p = JSON.parse(localStorage.getItem('yeepsPosts')) || [];
            p.push({ id: Date.now(), username: currentUser, content: content });
            localStorage.setItem('yeepsPosts', JSON.stringify(p));
            location.reload();
        }

        function loadFeed() {
            const posts = JSON.parse(localStorage.getItem('yeepsPosts')) || [];
            const list = document.getElementById('feed');
            const roleNames = { owner: "Owner", creator: "Content Creator", rat: "Lab Rat", star: "Star Creator", starprog: "Star Program", gamemod: "Game Mod", discordmod: "Discord Mod", webmod: "Web Mod", dev: "Game Dev" };

            posts.slice().reverse().forEach(p => {
                let r = (p.username === ADMIN_NAME) ? "owner" : (rolesDB[p.username] || "");
                let check = ["owner", "dev", "star", "gamemod"].includes(r) ? '‚úî' : '';
                list.innerHTML += `
                    <div class="post">
                        <div class="post-header">
                            <img src="https://ui-avatars.com/api/?name=${p.username}" style="width:40px; border-radius:50%;">
                            <div>
                                <strong>${p.username} <span class="checkmark">${check}</span></strong>
                                <div class="role-container">
                                    ${r ? `<img src="Images/roles/${r}.png" class="role-icon" onerror="this.style.display='none'">` : ''}
                                    ${r ? `<div class="badge role-${r}" style="background:var(--role-${r})">${roleNames[r]}</div>` : ''}
                                </div>
                            </div>
                        </div>
                        <p>${p.content}</p>
                    </div>`;
            });
        }
        function logout() { localStorage.removeItem('current_yeep_user'); location.reload(); }
        loadFeed();
    </script>
</body>
</html>
