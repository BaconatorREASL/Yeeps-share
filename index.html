<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yeeps-Share</title>
    <style>
        :root {
            --yeeps-orange: #FF8C00;
            --yeeps-yellow: #FFD700;
            --yeeps-blue: #87CEEB;
            --yeeps-dark: #333;
            --yeeps-pink: #ff4d94;
        }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            background-color: var(--yeeps-blue);
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 80px 20px 20px 20px;
        }

        /* --- MODALS --- */
        #loginOverlay, #roleModal { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); display: flex; 
            justify-content: center; align-items: center; z-index: 2000; 
        }
        
        .modal-box { 
            background: white; padding: 30px; border-radius: 20px; 
            text-align: center; border: 5px solid var(--yeeps-orange); width: 320px; 
        }

        /* --- POST STYLES --- */
        .post { background: white; padding: 15px; margin-bottom: 20px; border-radius: 15px; width: 100%; max-width: 500px; box-shadow: 0 4px 0 rgba(0,0,0,0.05); }
        .post.pinned { border: 4px solid var(--yeeps-yellow); background: #fffbea; }
        
        .pfp { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid var(--yeeps-orange); }
        .post-header { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
        .post-user-info { display: flex; flex-direction: column; }
        .username-text { font-weight: bold; color: var(--yeeps-orange); }
        .user-bio { font-size: 0.75rem; color: #666; font-style: italic; }
        
        .badge { font-size: 0.6rem; padding: 2px 8px; border-radius: 10px; color: white; text-transform: uppercase; width: fit-content; margin-top: 2px; }
        .badge-owner { background: var(--yeeps-yellow); color: var(--yeeps-dark); font-weight: bold; }

        .input-container { background: white; padding: 20px; border-radius: 15px; width: 100%; max-width: 500px; margin-bottom: 30px; border: 4px solid var(--yeeps-orange); }
        input, select, textarea { width: 90%; padding: 10px; margin-bottom: 10px; border: 2px solid #ddd; border-radius: 10px; font-family: inherit; }
        
        .btn-main { padding: 10px; background: var(--yeeps-orange); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .top-nav { position: fixed; top: 0; width: 100%; background: rgba(0, 0, 0, 0.8); padding: 10px 0; display: flex; justify-content: center; gap: 15px; z-index: 1000; }
        .top-nav a { color: white; text-decoration: none; font-weight: bold; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div class="modal-box">
            <h2>Yeeps-Share</h2>
            <input type="text" id="loginUsername" placeholder="Username">
            <input type="password" id="loginPassword" placeholder="Password">
            <input type="text" id="loginPfp" placeholder="PFP Link (Optional)">
            <textarea id="loginBio" placeholder="Tell us about yourself..." rows="2"></textarea>
            <button class="btn-main" style="width:100%" onclick="performLogin()">Join Yeeps</button>
        </div>
    </div>

    <div id="roleModal" style="display:none;">
        <div class="modal-box">
            <h3>Assign Role</h3>
            <input type="text" id="targetUser" placeholder="Username">
            <select id="roleSelect">
                <option value="rat">Lab Rat</option>
                <option value="reviewer">Reviewer</option>
                <option value="mod">Moderator</option>
                <option value="dev">Yeeps Dev</option>
                <option value="webdev">Website Dev</option>
                <option value="none">Remove Role</option>
            </select>
            <button class="btn-main" style="width:100%" onclick="saveRoleFromPopup()">Apply Role</button>
            <button onclick="document.getElementById('roleModal').style.display='none'" style="background:none; border:none; cursor:pointer; margin-top:10px;">Close</button>
        </div>
    </div>

    <nav class="top-nav">
        <a href="https://www.meta.com/experiences/7276525889052788/" target="_blank">üéÆ Play</a>
        <a href="https://discord.gg/yeeps" target="_blank">üí¨ Discord</a>
        <a href="#" onclick="logout()" style="color: #ff4d4d;">Logout</a>
    </nav>

    <h1>üß± Yeeps-Share</h1>

    <div id="ownerTools" style="display:none; margin-bottom: 20px; display: flex; gap: 10px;">
        <button class="btn-main" style="background: var(--yeeps-yellow); color:black;" onclick="document.getElementById('roleModal').style.display='flex'">üëë Role Manager</button>
    </div>

    <div id="featured-zone" style="display:none; width: 100%; max-width: 500px;">
        <div style="background: var(--yeeps-yellow); padding: 5px 15px; border-radius: 20px; font-weight: bold; margin-bottom: 10px; display: inline-block;">‚≠ê Featured (Fresh)</div>
        <div id="featured-feed"></div>
    </div>

    <div class="input-container">
        <input type="text" id="postText" placeholder="Post a Yeep tip!">
        <select id="mediaType">
            <option value="none">Text Only</option>
            <option value="image">üñºÔ∏è Image URL</option>
        </select>
        <input type="text" id="mediaUrl" placeholder="Image URL here..." style="display:none;">
        <button class="btn-main" style="width:100%" onclick="addPost()">Post to Feed</button>
    </div>

    <div id="feed" style="width: 100%; max-width: 500px;"></div>

    <script>
        const ADMIN_USERNAME = "DatWeirdFNFfan";
        const ADMIN_PASS = "yeep123"; 

        let isAdmin = false;

        // --- LOGIN LOGIC ---
        function performLogin() {
            const user = document.getElementById('loginUsername').value.trim();
            const pass = document.getElementById('loginPassword').value.trim();
            const pfp = document.getElementById('loginPfp').value.trim() || "https://ui-avatars.com/api/?name=" + user;
            const bio = document.getElementById('loginBio').value.trim() || "No bio yet.";

            if(!user || !pass) return;

            let usersDB = JSON.parse(localStorage.getItem('yeeps_users_db')) || {};

            if(user === ADMIN_USERNAME) {
                if(pass !== ADMIN_PASS) { alert("Wrong Admin Pass!"); return; }
                isAdmin = true;
            } else if (usersDB[user] && usersDB[user].password !== pass) {
                alert("Incorrect Password!"); return;
            }

            usersDB[user] = { password: pass, pfp: pfp, bio: bio };
            localStorage.setItem('yeeps_users_db', JSON.stringify(usersDB));
            localStorage.setItem('current_yeep_user', user);
            location.reload();
        }

        // --- POSTING & FEATURE LOGIC ---
        function addPost() {
            const text = document.getElementById('postText').value;
            const type = document.getElementById('mediaType').value;
            const url = document.getElementById('mediaUrl').value;
            const user = localStorage.getItem('current_yeep_user');

            if(!text) return;

            let posts = JSON.parse(localStorage.getItem('yeepsPosts')) || [];
            posts.push({ 
                id: Date.now(), 
                username: user, 
                content: text, 
                mediaType: type, 
                mediaUrl: url,
                isPinned: false,
                pinnedAt: null 
            });
            localStorage.setItem('yeepsPosts', JSON.stringify(posts));
            location.reload();
        }

        function togglePin(id) {
            let posts = JSON.parse(localStorage.getItem('yeepsPosts')) || [];
            const idx = posts.findIndex(p => p.id === id);
            
            if (!posts[idx].isPinned) {
                posts[idx].isPinned = true;
                posts[idx].pinnedAt = Date.now();
                
                // Limit check: Max 25
                let pinnedPosts = posts.filter(p => p.isPinned).sort((a,b) => a.pinnedAt - b.pinnedAt);
                if (pinnedPosts.length > 25) {
                    const oldestId = pinnedPosts[0].id;
                    const oldIdx = posts.findIndex(p => p.id === oldestId);
                    posts[oldIdx].isPinned = false;
                }
            } else {
                posts[idx].isPinned = false;
            }

            localStorage.setItem('yeepsPosts', JSON.stringify(posts));
            location.reload();
        }

        function cleanExpiredPins() {
            let posts = JSON.parse(localStorage.getItem('yeepsPosts')) || [];
            const ONE_WEEK = 7 * 24 * 60 * 60 * 1000;
            let changed = false;

            posts.forEach(p => {
                if (p.isPinned && p.pinnedAt && (Date.now() - p.pinnedAt > ONE_WEEK)) {
                    p.isPinned = false;
                    changed = true;
                }
            });

            if (changed) localStorage.setItem('yeepsPosts', JSON.stringify(posts));
        }

        function renderPost(post) {
            const usersDB = JSON.parse(localStorage.getItem('yeeps_users_db')) || {};
            const rolesDB = JSON.parse(localStorage.getItem('yeeps_roles_db')) || {};
            
            const userData = usersDB[post.username] || {};
            const userPfp = userData.pfp || "https://ui-avatars.com/api/?name=" + post.username;
            const userBio = userData.bio || "No bio.";
            const role = rolesDB[post.username] || "";

            const postDiv = document.createElement('div');
            postDiv.className = `post ${post.isPinned ? 'pinned' : ''}`;

            let badgeHTML = post.username === ADMIN_USERNAME ? '<span class="badge badge-owner">Owner</span>' : (role ? `<span class="badge" style="background:#555">${role}</span>` : '');

            postDiv.innerHTML = `
                <div class="post-header">
                    <img src="${userPfp}" class="pfp">
                    <div class="post-user-info">
                        <span class="username-text">${post.username}</span>
                        <span class="user-bio">${userBio}</span>
                        ${badgeHTML}
                    </div>
                </div>
                <div style="margin-top:5px;">${post.content}</div>
                ${post.mediaType === 'image' && post.mediaUrl ? `<img src="${post.mediaUrl}" style="width:100%; border-radius:10px; margin-top:10px;">` : ''}
                <div style="margin-top:12px; display:flex; gap:10px; align-items:center;">
                    ${(isAdmin || post.username === localStorage.getItem('current_yeep_user')) ? `<button onclick="deletePost(${post.id})" style="border:none; background:none; color:red; cursor:pointer; font-size:0.75rem;">Delete</button>` : ''}
                    ${isAdmin ? `<button onclick="togglePin(${post.id})" style="border:none; background:none; color:blue; cursor:pointer; font-size:0.75rem;">${post.isPinned ? 'Unfeature' : 'Feature'}</button>` : ''}
                </div>
            `;
            return postDiv;
        }

        function deletePost(id) {
            let posts = JSON.parse(localStorage.getItem('yeepsPosts')) || [];
            posts = posts.filter(p => p.id !== id);
            localStorage.setItem('yeepsPosts', JSON.stringify(posts));
            location.reload();
        }

        function loadPosts() {
            cleanExpiredPins();
            const posts = JSON.parse(localStorage.getItem('yeepsPosts')) || [];
            const feed = document.getElementById('feed');
            const fFeed = document.getElementById('featured-feed');
            feed.innerHTML = ''; fFeed.innerHTML = '';

            let hasFeatured = false;
            posts.slice().reverse().forEach(p => {
                const el = renderPost(p);
                if (p.isPinned) {
                    fFeed.appendChild(el);
                    hasFeatured = true;
                } else {
                    feed.appendChild(el);
                }
            });
            document.getElementById('featured-zone').style.display = hasFeatured ? 'block' : 'none';
        }

        function logout() { localStorage.removeItem('current_yeep_user'); location.reload(); }
        
        document.addEventListener('DOMContentLoaded', () => {
            const currentUser = localStorage.getItem('current_yeep_user');
            if(currentUser) {
                document.getElementById('loginOverlay').style.display = 'none';
                if(currentUser === ADMIN_USERNAME) isAdmin = true;
                if(isAdmin) document.getElementById('ownerTools').style.display = 'flex';
                loadPosts();
            }
        });

        document.getElementById('mediaType').addEventListener('change', function() {
            document.getElementById('mediaUrl').style.display = this.value === 'none' ? 'none' : 'block';
        });
    </script>
</body>
</html>
