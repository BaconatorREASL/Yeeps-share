<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Yeeps-Share | Home</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="top-nav">
        <img src="Images/Logo/Logo.png" class="nav-logo" onclick="location.href='index.html'">
        <a href="index.html">ğŸ  Home</a>
        <a href="pages/profile-editor.html">âš™ï¸ Settings</a>
        <a href="#" onclick="logout()" style="color:red;">Logout</a>
    </nav>

    <div id="staffPanel" style="display:none;" class="admin-panel">
        <h3 style="color:var(--yeeps-orange); margin:0 0 10px 0;">ğŸ› ï¸ Staff Dashboard</h3>
        <div style="display:flex; gap:15px;">
            <div style="flex:1;">
                <small>Moderation</small>
                <input type="text" id="modTarget" placeholder="Username">
                <input type="text" id="modReason" placeholder="Reason for action">
                <select id="modAction">
                    <option value="warn">âš ï¸ Warn</option>
                    <option value="timeout_10">ğŸ•’ 10m Timeout</option>
                    <option value="ban_perm">ğŸš« Perm Ban</option>
                </select>
                <button onclick="applyMod()" style="background:red; color:white; width:100%; margin-top:5px;">Execute</button>
            </div>
            <div id="ownerOnlyTools" style="display:none; flex:1; border-left:1px solid #444; padding-left:15px;">
                <small style="color:var(--yeeps-orange);">ğŸ‘‘ Roles</small>
                <select id="roleSelect">
                    <option value="creator">Creator</option>
                    <option value="star">Star</option>
                    <option value="webmod">Web Mod</option>
                    <option value="dev">Dev</option>
                </select>
                <button onclick="manageRole('add')" style="background:var(--yeeps-orange); width:100%; margin-bottom:5px;">Add</button>
                <button onclick="manageRole('remove')" style="background:#444; color:white; width:100%;">Rem</button>
            </div>
        </div>
    </div>

    <div class="input-box">
        <textarea id="postContent" placeholder="What's happening?" oninput="checkCharLimit()"></textarea>
        <div id="charCount" style="text-align:right; font-size:0.7rem; color:gray;">0 / 280</div>
        <input type="text" id="mediaUrl" placeholder="Media Link (YouTube/Image/Video)">
        <button id="postBtn" onclick="submitPost()" style="width:100%; background:var(--yeeps-orange); color:white; font-weight:bold; margin-top:10px;">POST</button>
    </div>

    <div id="featured-zone"></div>
    <div id="feed"></div>

    <script>
        const ADMIN_NAME = "DatWeirdFNFfan";
        const currentUser = localStorage.getItem('current_yeep_user');
        if (!currentUser) window.location.href = "login.html";

        const rolesDB = JSON.parse(localStorage.getItem('yeeps_roles_db')) || {};
        const usersDB = JSON.parse(localStorage.getItem('yeeps_users_db')) || {};
        const statusDB = JSON.parse(localStorage.getItem('yeeps_status_db')) || {};

        const myRoles = (currentUser === ADMIN_NAME) ? ["owner"] : (rolesDB[currentUser] || []);
        const isOwner = (currentUser === ADMIN_NAME);
        const isStaff = myRoles.some(r => ["webmod", "dev", "owner"].includes(r));
        const maxChars = myRoles.some(r => ["star", "starprog", "owner", "dev"].includes(r)) ? 560 : 280;

        if (isStaff) document.getElementById('staffPanel').style.display = 'block';
        if (isOwner) document.getElementById('ownerOnlyTools').style.display = 'block';

        function applyMod() {
            const target = document.getElementById('modTarget').value.trim();
            const action = document.getElementById('modAction').value;
            const reason = document.getElementById('modReason').value || "No reason provided.";
            if (!target || target === ADMIN_NAME) return;

            statusDB[target] = { type: action, reason: reason, expires: action === "timeout_10" ? Date.now() + 600000 : "PERMANENT" };
            localStorage.setItem('yeeps_status_db', JSON.stringify(statusDB));
            alert(`Action applied to ${target}`);
        }

        function manageRole(action) {
            const target = document.getElementById('modTarget').value.trim();
            const role = document.getElementById('roleSelect').value;
            if(!rolesDB[target]) rolesDB[target] = [];
            if(action === 'add' && !rolesDB[target].includes(role)) rolesDB[target].push(role);
            if(action === 'remove') rolesDB[target] = rolesDB[target].filter(r => r !== role);
            localStorage.setItem('yeeps_roles_db', JSON.stringify(rolesDB));
            location.reload();
        }

        function submitPost() {
            const content = document.getElementById('postContent').value.trim();
            const media = document.getElementById('mediaUrl').value.trim();
            let posts = JSON.parse(localStorage.getItem('yeepsPosts')) || [];
            posts.push({ id: Date.now(), username: currentUser, content: content, media: media, likes: [], featured: false });
            localStorage.setItem('yeepsPosts', JSON.stringify(posts));
            location.reload();
        }

        function toggleLike(id) {
            let posts = JSON.parse(localStorage.getItem('yeepsPosts')) || [];
            let p = posts.find(x => x.id === id);
            if(!p.likes) p.likes = [];
            
            if(p.likes.includes(currentUser)) p.likes = p.likes.filter(u => u !== currentUser);
            else p.likes.push(currentUser);

            // Auto-Feature logic (5 likes)
            if(p.likes.length >= 5) p.featured = true;

            localStorage.setItem('yeepsPosts', JSON.stringify(posts));
            loadFeed();
        }

        function deletePost(id) {
            if(!confirm("Delete post?")) return;
            let posts = JSON.parse(localStorage.getItem('yeepsPosts')) || [];
            localStorage.setItem('yeepsPosts', JSON.stringify(posts.filter(x => x.id !== id)));
            location.reload();
        }

        function toggleFeature(id) {
            if(!isOwner) return;
            let posts = JSON.parse(localStorage.getItem('yeepsPosts')) || [];
            let p = posts.find(x => x.id === id);
            p.featured = !p.featured;
            localStorage.setItem('yeepsPosts', JSON.stringify(posts));
            location.reload();
        }

        function loadFeed() {
            const posts = JSON.parse(localStorage.getItem('yeepsPosts')) || [];
            const feed = document.getElementById('feed');
            const featured = document.getElementById('featured-zone');
            feed.innerHTML = ""; featured.innerHTML = "";

            posts.slice().reverse().forEach(p => {
                let uRoles = (p.username === ADMIN_NAME) ? ["owner"] : (rolesDB[p.username] || []);
                let mainColor = uRoles.length > 0 ? `role-${uRoles[0]}` : "";
                let pfp = usersDB[p.username]?.pfp || "https://ui-avatars.com/api/?name=" + p.username;
                let liked = p.likes?.includes(currentUser);

                const div = document.createElement('div');
                div.className = `post ${p.featured ? 'pinned' : ''}`;
                div.innerHTML = `
                    <div style="display:flex; align-items:center; justify-content:space-between;">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <img src="${pfp}" class="pfp-img">
                            <strong class="${mainColor}">${p.username}</strong>
                        </div>
                        <div>
                            ${(isStaff || p.username === currentUser) ? `<span onclick="deletePost(${p.id})" style="color:red; cursor:pointer; margin-right:10px;">ğŸ—‘ï¸</span>` : ''}
                            ${isOwner ? `<span onclick="toggleFeature(${p.id})" style="cursor:pointer;">â­</span>` : ''}
                        </div>
                    </div>
                    <p>${p.content}</p>
                    <div style="margin-top:10px; display:flex; gap:20px;">
                        <span onclick="toggleLike(${p.id})" style="cursor:pointer; color:${liked ? 'var(--yeeps-orange)' : 'gray'}">â¤ï¸ ${p.likes?.length || 0}</span>
                        <a href="pages/comments.html?postId=${p.id}" style="color:gray; text-decoration:none;">ğŸ’¬ Comments</a>
                    </div>
                `;
                p.featured ? featured.appendChild(div) : feed.appendChild(div);
            });
        }

        function logout() { localStorage.removeItem('current_yeep_user'); location.reload(); }
        loadFeed();
    </script>
</body>
</html>
