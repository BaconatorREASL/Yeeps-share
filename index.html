<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Yeeps-Share | Home</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="top-nav">
        <img src="Images/Logo/Logo.png" class="nav-logo" onclick="location.href='index.html'">
        <a href="index.html">üè† Home</a>
        <a href="pages/profile-editor.html">‚öôÔ∏è Settings</a>
        <a href="#" onclick="localStorage.removeItem('current_yeep_user'); location.reload();" style="color:red;">Logout</a>
    </nav>

    <div class="input-box">
        <textarea id="postContent" placeholder="What's happening?"></textarea>
        <input type="text" id="mediaUrl" placeholder="Image, Video, or YouTube Link (Optional)" style="margin-top:5px;">
        <button onclick="submitPost()" style="width:100%; background:var(--yeeps-orange); color:white; font-weight:bold; margin-top:10px;">POST</button>
    </div>

    <div id="feed"></div>

    <script>
        const ADMIN_NAME = "DatWeirdFNFfan";
        const currentUser = localStorage.getItem('current_yeep_user');
        if (!currentUser) window.location.href = "login.html";

        const rolesDB = JSON.parse(localStorage.getItem('yeeps_roles_db')) || {};
        const usersDB = JSON.parse(localStorage.getItem('yeeps_users_db')) || {};

        function submitPost() {
            const content = document.getElementById('postContent').value.trim();
            const media = document.getElementById('mediaUrl').value.trim();
            if(!content && !media) return;

            let posts = JSON.parse(localStorage.getItem('yeepsPosts')) || [];
            posts.push({ 
                id: Date.now(), 
                username: currentUser, 
                content: content, 
                media: media 
            });
            localStorage.setItem('yeepsPosts', JSON.stringify(posts));
            location.reload();
        }

        // --- MEDIA PARSER ---
        function renderMedia(url) {
            if(!url) return "";
            
            // Check for YouTube
            if(url.includes("youtube.com") || url.includes("youtu.be")) {
                let vidId = "";
                if(url.includes("v=")) vidId = url.split("v=")[1].split("&")[0];
                else vidId = url.split("/").pop();
                return `<iframe width="100%" height="250" src="https://www.youtube.com/embed/${vidId}" frameborder="0" allowfullscreen style="border-radius:10px; margin-top:10px;"></iframe>`;
            }

            // Check for Raw Video (mp4, webm)
            if(url.match(/\.(mp4|webm|ogg)$/i)) {
                return `<video controls style="width:100%; border-radius:10px; margin-top:10px;"><source src="${url}"></video>`;
            }

            // Default to Image
            return `<img src="${url}" style="width:100%; border-radius:10px; margin-top:10px;" onerror="this.style.display='none'">`;
        }

        function loadFeed() {
            const posts = JSON.parse(localStorage.getItem('yeepsPosts')) || [];
            const roleNames = { owner: "Owner", creator: "Creator", rat: "Lab Rat", star: "Star", starprog: "Star Program", gamemod: "Game Mod", discordmod: "Discord Mod", webmod: "Web Mod", dev: "Dev" };
            
            posts.slice().reverse().forEach(p => {
                let uRoles = (p.username === ADMIN_NAME) ? ["owner"] : (rolesDB[p.username] || []);
                if(!Array.isArray(uRoles)) uRoles = [uRoles];

                let mainColor = uRoles.length > 0 ? `role-${uRoles[0]}` : "";
                let icons = uRoles.map(r => `<img src="Images/roles/${r}.png" class="inline-icon">`).join('');
                let pfp = usersDB[p.username]?.pfp || "https://ui-avatars.com/api/?name=" + p.username;

                const div = document.createElement('div');
                div.className = "post";
                div.innerHTML = `
                    <div style="display:flex; align-items:center; gap:12px;">
                        <img src="${pfp}" class="pfp-img" onclick="location.href='pages/user-profile.html?u=${p.username}'">
                        <div>
                            <div style="display:flex; align-items:center;">
                                <strong class="${mainColor}" style="cursor:pointer;" onclick="location.href='pages/user-profile.html?u=${p.username}'">${p.username}</strong>
                                ${icons}
                            </div>
                            <div style="display:flex; gap:5px; margin-top:2px;">
                                ${uRoles.map(r => `<span class="badge" style="background:var(--color-${r})">${roleNames[r]}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                    <p style="margin-top:15px; white-space: pre-wrap;">${p.content}</p>
                    ${renderMedia(p.media)}
                    <div style="margin-top:15px;"><a href="pages/comments.html?postId=${p.id}" style="color:var(--yeeps-orange); font-size:0.8rem; text-decoration:none;">üí¨ View Comments</a></div>
                `;
                document.getElementById('feed').appendChild(div);
            });
        }
        loadFeed();
    </script>
</body>
</html>
